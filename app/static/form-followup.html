<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario B: Reporte de Seguimiento - Maxocracia</title>
    <link rel="stylesheet" href="/static/css/vhv.css">
    <link rel="stylesheet" href="/static/css/forms.css">
</head>

<body>
    <div class="forms-container">
        <!-- Hero Section -->
        <div class="forms-hero">
            <h1 class="forms-hero-title">ğŸ“Š Reporte de Seguimiento</h1>
            <p class="forms-hero-subtitle">
                Este formulario sirve para hacer seguimiento a intercambios en curso o verificar
                cÃ³mo evolucionan las situaciones de los participantes despuÃ©s de recibir ayuda.
                Toma menos de 2 minutos. Â¡Gracias!
            </p>
        </div>

        <!-- Success Message -->
        <div id="successMessage" class="forms-success" style="display: none;">
            <div class="forms-success-icon">âœ…</div>
            <h2 class="forms-success-title">Â¡Seguimiento Registrado!</h2>
            <p class="forms-success-message" id="successDetails"></p>
            <button class="forms-btn forms-btn-primary" onclick="resetForm()" style="margin-top: 1rem;">
                Registrar Otro Seguimiento
            </button>
        </div>

        <!-- Error Message -->
        <div id="errorMessage" class="forms-error" style="display: none;">
            <span class="forms-error-icon">âš ï¸</span>
            <span id="errorText"></span>
        </div>

        <!-- Form -->
        <form id="followupForm" class="forms-card">
            <!-- SECCIÃ“N 1: IdentificaciÃ³n -->
            <div class="forms-section">
                <h2 class="forms-section-title">
                    <span class="forms-emoji">ğŸ”–</span>
                    SECCIÃ“N 1: IdentificaciÃ³n
                </h2>

                <div class="forms-group">
                    <label class="forms-label forms-label-required" for="follow_up_date">Fecha de este
                        seguimiento</label>
                    <input type="date" id="follow_up_date" name="follow_up_date" class="forms-input" required>
                    <span class="forms-help-text">Â¿CuÃ¡ndo estÃ¡s haciendo este chequeo?</span>
                </div>

                <div class="forms-group">
                    <label class="forms-label forms-label-required" for="participant_name">Â¿A quiÃ©n le estÃ¡s haciendo
                        seguimiento?</label>
                    <input type="text" id="participant_name" name="participant_name" class="forms-input" required>
                    <span class="forms-help-text">Nombre o alias de la persona</span>
                </div>

                <div class="forms-group">
                    <label class="forms-label" for="related_interchange_code">CÃ³digo de Intercambio Original (si
                        aplica)</label>
                    <input type="text" id="related_interchange_code" name="related_interchange_code" class="forms-input"
                        placeholder="INT-001">
                    <span class="forms-help-text">Si este seguimiento estÃ¡ relacionado con un intercambio registrado,
                        pon su cÃ³digo. Si no, deja en blanco.</span>
                </div>
            </div>

            <!-- SECCIÃ“N 2: Tipo de Seguimiento -->
            <div class="forms-section">
                <h2 class="forms-section-title">
                    <span class="forms-emoji">ğŸ“</span>
                    SECCIÃ“N 2: Tipo de Seguimiento
                </h2>

                <div class="forms-group">
                    <label class="forms-label forms-label-required">Â¿QuÃ© tipo de seguimiento es este?</label>
                    <div class="forms-radio-group">
                        <div class="forms-radio-item">
                            <input type="radio" id="type_verification" name="follow_up_type"
                                value="verification_completed" required>
                            <label for="type_verification">ğŸ“Š VerificaciÃ³n de intercambio completado</label>
                        </div>
                        <div class="forms-radio-item">
                            <input type="radio" id="type_update" name="follow_up_type" value="update_in_progress">
                            <label for="type_update">ğŸ”„ ActualizaciÃ³n de intercambio en curso</label>
                        </div>
                        <div class="forms-radio-item">
                            <input type="radio" id="type_evolution" name="follow_up_type" value="situation_evolution">
                            <label for="type_evolution">ğŸ“ˆ EvoluciÃ³n de situaciÃ³n despuÃ©s de recibir ayuda</label>
                        </div>
                        <div class="forms-radio-item">
                            <input type="radio" id="type_urgent" name="follow_up_type" value="new_urgent_need">
                            <label for="type_urgent">ğŸ†˜ Nueva necesidad urgente detectada</label>
                        </div>
                        <div class="forms-radio-item">
                            <input type="radio" id="type_resolved" name="follow_up_type" value="need_resolved">
                            <label for="type_resolved">âœ… Necesidad completamente resuelta (cerrar caso)</label>
                        </div>
                        <div class="forms-radio-item">
                            <input type="radio" id="type_feedback" name="follow_up_type" value="spontaneous_feedback">
                            <label for="type_feedback">ğŸ’¬ Feedback espontÃ¡neo del participante</label>
                        </div>
                        <div class="forms-radio-item">
                            <input type="radio" id="type_routine" name="follow_up_type" value="routine_check">
                            <label for="type_routine">ğŸ” Chequeo rutinario</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SECCIÃ“N 3: Estado Actual -->
            <div class="forms-section">
                <h2 class="forms-section-title">
                    <span class="forms-emoji">ğŸ“Š</span>
                    SECCIÃ“N 3: Estado Actual
                </h2>

                <div class="forms-group">
                    <label class="forms-label forms-label-required" for="current_situation">Â¿CÃ³mo estÃ¡ la situaciÃ³n
                        ahora?</label>
                    <textarea id="current_situation" name="current_situation" class="forms-textarea" required
                        placeholder="Describe brevemente la situaciÃ³n actual de la persona. Â¿MejorÃ³? Â¿Sigue igual? Â¿EmpeorÃ³? Â¿Surgieron nuevas necesidades?"></textarea>
                </div>

                <div class="forms-group">
                    <label class="forms-label forms-label-required">Nivel de necesidad actual</label>
                    <p class="forms-help-text">EvaluaciÃ³n general de quÃ© tan apremiante es su situaciÃ³n ahora</p>
                    <div class="forms-radio-group">
                        <div class="forms-radio-item">
                            <input type="radio" id="need_1" name="need_level" value="1" required>
                            <label for="need_1">1 - Necesidad resuelta / SituaciÃ³n estable</label>
                        </div>
                        <div class="forms-radio-item">
                            <input type="radio" id="need_2" name="need_level" value="2">
                            <label for="need_2">2 - Necesidad baja</label>
                        </div>
                        <div class="forms-radio-item">
                            <input type="radio" id="need_3" name="need_level" value="3">
                            <label for="need_3">3 - Necesidad moderada</label>
                        </div>
                        <div class="forms-radio-item">
                            <input type="radio" id="need_4" name="need_level" value="4">
                            <label for="need_4">4 - Necesidad alta</label>
                        </div>
                        <div class="forms-radio-item">
                            <input type="radio" id="need_5" name="need_level" value="5">
                            <label for="need_5">5 - Necesidad crÃ­tica / SituaciÃ³n urgente</label>
                        </div>
                    </div>
                </div>

                <div class="forms-group">
                    <label class="forms-label forms-label-required">Comparado con el Ãºltimo reporte, la
                        situaciÃ³n:</label>
                    <div class="forms-radio-group">
                        <div class="forms-radio-item">
                            <input type="radio" id="change_improved_sig" name="situation_change"
                                value="improved_significantly" required>
                            <label for="change_improved_sig">ğŸ“ˆ MejorÃ³ significativamente</label>
                        </div>
                        <div class="forms-radio-item">
                            <input type="radio" id="change_improved" name="situation_change" value="improved_slightly">
                            <label for="change_improved">ğŸ”¼ MejorÃ³ un poco</label>
                        </div>
                        <div class="forms-radio-item">
                            <input type="radio" id="change_same" name="situation_change" value="same">
                            <label for="change_same">â¡ï¸ EstÃ¡ igual</label>
                        </div>
                        <div class="forms-radio-item">
                            <input type="radio" id="change_worsened" name="situation_change" value="worsened_slightly">
                            <label for="change_worsened">ğŸ”½ EmpeorÃ³ un poco</label>
                        </div>
                        <div class="forms-radio-item">
                            <input type="radio" id="change_worsened_sig" name="situation_change"
                                value="worsened_significantly">
                            <label for="change_worsened_sig">ğŸ“‰ EmpeorÃ³ significativamente</label>
                        </div>
                        <div class="forms-radio-item">
                            <input type="radio" id="change_first" name="situation_change" value="first_evaluation">
                            <label for="change_first">ğŸ†• Primera evaluaciÃ³n (no hay comparaciÃ³n)</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SECCIÃ“N 4: Intercambios Activos -->
            <div class="forms-section">
                <h2 class="forms-section-title">
                    <span class="forms-emoji">ğŸ”„</span>
                    SECCIÃ“N 4: Intercambios Activos
                </h2>

                <div class="forms-group">
                    <label class="forms-label forms-label-required">Â¿Hay intercambios activos con esta persona?</label>
                    <div class="forms-radio-group">
                        <div class="forms-radio-item">
                            <input type="radio" id="active_receiving" name="active_interchanges_status"
                                value="receiving_help" required>
                            <label for="active_receiving">âœ… SÃ­ - Recibiendo ayuda actualmente</label>
                        </div>
                        <div class="forms-radio-item">
                            <input type="radio" id="active_giving" name="active_interchanges_status"
                                value="giving_help">
                            <label for="active_giving">âœ… SÃ­ - Dando ayuda actualmente</label>
                        </div>
                        <div class="forms-radio-item">
                            <input type="radio" id="active_both" name="active_interchanges_status" value="both">
                            <label for="active_both">âœ… SÃ­ - Ambos (dando y recibiendo)</label>
                        </div>
                        <div class="forms-radio-item">
                            <input type="radio" id="active_none" name="active_interchanges_status" value="none">
                            <label for="active_none">âŒ No - No hay intercambios activos ahora</label>
                        </div>
                        <div class="forms-radio-item">
                            <input type="radio" id="active_paused" name="active_interchanges_status" value="paused">
                            <label for="active_paused">â¸ Pausado temporalmente</label>
                        </div>
                    </div>
                </div>

                <div class="forms-group" id="interchangesWorkingGroup" style="display: none;">
                    <label class="forms-label">Si hay intercambios activos, Â¿estÃ¡n funcionando bien?</label>
                    <div class="forms-radio-group">
                        <div class="forms-radio-item">
                            <input type="radio" id="working_very_well" name="interchanges_working_well"
                                value="very_well">
                            <label for="working_very_well">âœ… Funcionan muy bien</label>
                        </div>
                        <div class="forms-radio-item">
                            <input type="radio" id="working_minor" name="interchanges_working_well"
                                value="minor_difficulties">
                            <label for="working_minor">ğŸŸ¡ Funcionan pero con dificultades menores</label>
                        </div>
                        <div class="forms-radio-item">
                            <input type="radio" id="working_problems" name="interchanges_working_well"
                                value="significant_problems">
                            <label for="working_problems">âš ï¸ Hay problemas significativos</label>
                        </div>
                        <div class="forms-radio-item">
                            <input type="radio" id="working_adjustment" name="interchanges_working_well"
                                value="needs_adjustment">
                            <label for="working_adjustment">ğŸ” Necesitan ajustes o rediseÃ±o</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SECCIÃ“N 5: DetecciÃ³n de Nuevas Oportunidades -->
            <div class="forms-section">
                <h2 class="forms-section-title">
                    <span class="forms-emoji">ğŸ”</span>
                    SECCIÃ“N 5: DetecciÃ³n de Nuevas Oportunidades
                </h2>

                <div class="forms-group">
                    <label class="forms-label">Â¿Se identificaron nuevas necesidades?</label>
                    <div class="forms-checkbox-group">
                        <div class="forms-checkbox-item">
                            <input type="checkbox" id="new_need_objeto" name="new_needs_detected" value="objeto">
                            <label for="new_need_objeto">ğŸ“¦ Objetos</label>
                        </div>
                        <div class="forms-checkbox-item">
                            <input type="checkbox" id="new_need_alimentacion" name="new_needs_detected"
                                value="alimentacion">
                            <label for="new_need_alimentacion">ğŸ½ AlimentaciÃ³n o Cocina</label>
                        </div>
                        <div class="forms-checkbox-item">
                            <input type="checkbox" id="new_need_habilidad" name="new_needs_detected" value="habilidad">
                            <label for="new_need_habilidad">ğŸ›  Habilidades o Servicios</label>
                        </div>
                        <div class="forms-checkbox-item">
                            <input type="checkbox" id="new_need_conocimiento" name="new_needs_detected"
                                value="conocimiento">
                            <label for="new_need_conocimiento">ğŸ“š Conocimiento o Consejo</label>
                        </div>
                        <div class="forms-checkbox-item">
                            <input type="checkbox" id="new_need_transporte" name="new_needs_detected"
                                value="transporte">
                            <label for="new_need_transporte">ğŸš— Transporte</label>
                        </div>
                        <div class="forms-checkbox-item">
                            <input type="checkbox" id="new_need_tiempo" name="new_needs_detected" value="tiempo">
                            <label for="new_need_tiempo">â° Tiempo y CompaÃ±Ã­a</label>
                        </div>
                        <div class="forms-checkbox-item">
                            <input type="checkbox" id="new_need_espacio" name="new_needs_detected" value="espacio">
                            <label for="new_need_espacio">ğŸ  Espacio</label>
                        </div>
                        <div class="forms-checkbox-item">
                            <input type="checkbox" id="new_need_apoyo" name="new_needs_detected"
                                value="apoyo_economico">
                            <label for="new_need_apoyo">ğŸ’° Apoyo EconÃ³mico</label>
                        </div>
                        <div class="forms-checkbox-item">
                            <input type="checkbox" id="new_need_none" name="new_needs_detected" value="none">
                            <label for="new_need_none">âŒ No, ninguna nueva necesidad</label>
                        </div>
                    </div>
                </div>

                <div class="forms-group">
                    <label class="forms-label">Â¿Se identificaron nuevas ofertas que puede hacer?</label>
                    <div class="forms-checkbox-group">
                        <div class="forms-checkbox-item">
                            <input type="checkbox" id="new_offer_objeto" name="new_offers_detected" value="objeto">
                            <label for="new_offer_objeto">ğŸ“¦ Objetos</label>
                        </div>
                        <div class="forms-checkbox-item">
                            <input type="checkbox" id="new_offer_alimentacion" name="new_offers_detected"
                                value="alimentacion">
                            <label for="new_offer_alimentacion">ğŸ½ AlimentaciÃ³n o Cocina</label>
                        </div>
                        <div class="forms-checkbox-item">
                            <input type="checkbox" id="new_offer_habilidad" name="new_offers_detected"
                                value="habilidad">
                            <label for="new_offer_habilidad">ğŸ›  Habilidades o Servicios</label>
                        </div>
                        <div class="forms-checkbox-item">
                            <input type="checkbox" id="new_offer_conocimiento" name="new_offers_detected"
                                value="conocimiento">
                            <label for="new_offer_conocimiento">ğŸ“š Conocimiento o Consejo</label>
                        </div>
                        <div class="forms-checkbox-item">
                            <input type="checkbox" id="new_offer_transporte" name="new_offers_detected"
                                value="transporte">
                            <label for="new_offer_transporte">ğŸš— Transporte</label>
                        </div>
                        <div class="forms-checkbox-item">
                            <input type="checkbox" id="new_offer_tiempo" name="new_offers_detected" value="tiempo">
                            <label for="new_offer_tiempo">â° Tiempo y CompaÃ±Ã­a</label>
                        </div>
                        <div class="forms-checkbox-item">
                            <input type="checkbox" id="new_offer_espacio" name="new_offers_detected" value="espacio">
                            <label for="new_offer_espacio">ğŸ  Espacio</label>
                        </div>
                        <div class="forms-checkbox-item">
                            <input type="checkbox" id="new_offer_apoyo" name="new_offers_detected"
                                value="apoyo_economico">
                            <label for="new_offer_apoyo">ğŸ’° Apoyo EconÃ³mico</label>
                        </div>
                        <div class="forms-checkbox-item">
                            <input type="checkbox" id="new_offer_none" name="new_offers_detected" value="none">
                            <label for="new_offer_none">âŒ No, nada nuevo que ofrecer por ahora</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SECCIÃ“N 6: Salud Emocional y ConexiÃ³n -->
            <div class="forms-section">
                <h2 class="forms-section-title">
                    <span class="forms-emoji">ğŸ’š</span>
                    SECCIÃ“N 6: Salud Emocional y ConexiÃ³n
                </h2>
                <p class="forms-section-description">
                    Estas preguntas ayudan a entender el bienestar general de las personas en la red,
                    mÃ¡s allÃ¡ de las necesidades materiales especÃ­ficas.
                </p>

                <div class="forms-group">
                    <label class="forms-label">Estado emocional/anÃ­mico percibido</label>
                    <div class="forms-radio-group">
                        <div class="forms-radio-item">
                            <input type="radio" id="emotion_very_good" name="emotional_state" value="very_good">
                            <label for="emotion_very_good">ğŸ˜Š Muy bien - Optimista, energizado</label>
                        </div>
                        <div class="forms-radio-item">
                            <input type="radio" id="emotion_good" name="emotional_state" value="good">
                            <label for="emotion_good">ğŸ™‚ Bien - Estable, tranquilo</label>
                        </div>
                        <div class="forms-radio-item">
                            <input type="radio" id="emotion_neutral" name="emotional_state" value="neutral">
                            <label for="emotion_neutral">ğŸ˜ Neutro - Ni bien ni mal</label>
                        </div>
                        <div class="forms-radio-item">
                            <input type="radio" id="emotion_worried" name="emotional_state" value="worried">
                            <label for="emotion_worried">ğŸ˜Ÿ Preocupado - Con estrÃ©s o ansiedad</label>
                        </div>
                        <div class="forms-radio-item">
                            <input type="radio" id="emotion_bad" name="emotional_state" value="bad">
                            <label for="emotion_bad">ğŸ˜¢ Mal - Desanimado, desesperanzado</label>
                        </div>
                        <div class="forms-radio-item">
                            <input type="radio" id="emotion_alert" name="emotional_state" value="alert_signs">
                            <label for="emotion_alert">ğŸš¨ SeÃ±ales de alerta - Posible crisis emocional</label>
                        </div>
                        <div class="forms-radio-item">
                            <input type="radio" id="emotion_unknown" name="emotional_state" value="could_not_evaluate">
                            <label for="emotion_unknown">â“ No pude evaluar</label>
                        </div>
                    </div>
                </div>

                <div class="forms-group">
                    <label class="forms-label">Â¿La persona siente conexiÃ³n con la comunidad?</label>
                    <p class="forms-help-text">Â¿QuÃ© tan integrada siente esta persona en la red de apoyo?</p>
                    <div class="forms-radio-group">
                        <div class="forms-radio-item">
                            <input type="radio" id="connection_1" name="community_connection" value="1">
                            <label for="connection_1">1 - Se siente aislada/desconectada</label>
                        </div>
                        <div class="forms-radio-item">
                            <input type="radio" id="connection_2" name="community_connection" value="2">
                            <label for="connection_2">2 - ConexiÃ³n baja</label>
                        </div>
                        <div class="forms-radio-item">
                            <input type="radio" id="connection_3" name="community_connection" value="3">
                            <label for="connection_3">3 - ConexiÃ³n moderada</label>
                        </div>
                        <div class="forms-radio-item">
                            <input type="radio" id="connection_4" name="community_connection" value="4">
                            <label for="connection_4">4 - Buena conexiÃ³n</label>
                        </div>
                        <div class="forms-radio-item">
                            <input type="radio" id="connection_5" name="community_connection" value="5">
                            <label for="connection_5">5 - Se siente parte integral de la red</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SECCIÃ“N 7: Acciones Necesarias -->
            <div class="forms-section">
                <h2 class="forms-section-title">
                    <span class="forms-emoji">ğŸ¯</span>
                    SECCIÃ“N 7: Acciones Necesarias
                </h2>

                <div class="forms-group">
                    <label class="forms-label forms-label-required">Â¿QuÃ© acciones se requieren?</label>
                    <div class="forms-checkbox-group">
                        <div class="forms-checkbox-item">
                            <input type="checkbox" id="action_match" name="actions_required" value="find_match">
                            <label for="action_match">ğŸ” Buscar nuevo match para necesidad urgente</label>
                        </div>
                        <div class="forms-checkbox-item">
                            <input type="checkbox" id="action_call" name="actions_required" value="deep_check">
                            <label for="action_call">ğŸ“ Hacer llamada de chequeo mÃ¡s profunda</label>
                        </div>
                        <div class="forms-checkbox-item">
                            <input type="checkbox" id="action_connect" name="actions_required"
                                value="facilitate_connection">
                            <label for="action_connect">ğŸ¤ Facilitar conexiÃ³n con alguien especÃ­fico de la red</label>
                        </div>
                        <div class="forms-checkbox-item">
                            <input type="checkbox" id="action_update" name="actions_required" value="update_info">
                            <label for="action_update">ğŸ“‹ Actualizar su informaciÃ³n en el sistema</label>
                        </div>
                        <div class="forms-checkbox-item">
                            <input type="checkbox" id="action_plan" name="actions_required" value="create_plan">
                            <label for="action_plan">ğŸ¯ Crear plan de acciÃ³n especÃ­fico</label>
                        </div>
                        <div class="forms-checkbox-item">
                            <input type="checkbox" id="action_urgent" name="actions_required"
                                value="urgent_intervention">
                            <label for="action_urgent">ğŸ”´ IntervenciÃ³n urgente necesaria</label>
                        </div>
                        <div class="forms-checkbox-item">
                            <input type="checkbox" id="action_celebrate" name="actions_required" value="celebrate">
                            <label for="action_celebrate">ğŸ‰ Celebrar logro/progreso con la red</label>
                        </div>
                        <div class="forms-checkbox-item">
                            <input type="checkbox" id="action_none" name="actions_required" value="none">
                            <label for="action_none">âœ… Ninguna - Todo bien por ahora</label>
                        </div>
                    </div>
                </div>

                <div class="forms-group">
                    <label class="forms-label forms-label-required">Prioridad de seguimiento</label>
                    <div class="forms-radio-group">
                        <div class="forms-radio-item">
                            <input type="radio" id="priority_high" name="follow_up_priority" value="high" required>
                            <label for="priority_high">ğŸ”´ Alta - Requiere atenciÃ³n en 24-48 horas</label>
                        </div>
                        <div class="forms-radio-item">
                            <input type="radio" id="priority_medium" name="follow_up_priority" value="medium">
                            <label for="priority_medium">ğŸŸ¡ Media - Revisar en la prÃ³xima semana</label>
                        </div>
                        <div class="forms-radio-item">
                            <input type="radio" id="priority_low" name="follow_up_priority" value="low">
                            <label for="priority_low">ğŸŸ¢ Baja - Seguimiento rutinario mensual</label>
                        </div>
                        <div class="forms-radio-item">
                            <input type="radio" id="priority_closed" name="follow_up_priority" value="closed">
                            <label for="priority_closed">âœ… Cerrado - No requiere mÃ¡s seguimiento</label>
                        </div>
                    </div>
                </div>

                <div class="forms-group" id="nextFollowupGroup" style="display: none;">
                    <label class="forms-label" for="next_follow_up_date">Â¿CuÃ¡ndo hacer el prÃ³ximo seguimiento?</label>
                    <input type="date" id="next_follow_up_date" name="next_follow_up_date" class="forms-input">
                    <span class="forms-help-text">Si marcaste que requiere seguimiento, Â¿para cuÃ¡ndo programarlo?</span>
                </div>
            </div>

            <!-- SECCIÃ“N 8: Observaciones del Facilitador -->
            <div class="forms-section">
                <h2 class="forms-section-title">
                    <span class="forms-emoji">ğŸ“</span>
                    SECCIÃ“N 8: Observaciones del Facilitador
                </h2>

                <div class="forms-group">
                    <label class="forms-label" for="facilitator_notes">Notas y observaciones</label>
                    <textarea id="facilitator_notes" name="facilitator_notes" class="forms-textarea"
                        placeholder="Cualquier cosa importante que notar: conversaciones relevantes, cambios en circunstancias, intuiciones sobre quÃ© podrÃ­a ayudar, etc."></textarea>
                </div>

                <div class="forms-group">
                    <label class="forms-label" for="learnings">Â¿Algo que aprendiste de este seguimiento?</label>
                    <textarea id="learnings" name="learnings" class="forms-textarea"
                        placeholder="Â¿QuÃ© insights emergieron? Â¿QuÃ© funcionÃ³ bien? Â¿QuÃ© cambiarÃ­as? Esto ayuda a mejorar el sistema."></textarea>
                </div>
            </div>

            <!-- Submit Button -->
            <button type="submit" class="forms-btn forms-btn-primary forms-btn-full" id="submitBtn">
                <span id="submitText">Registrar Seguimiento</span>
                <span id="submitLoading" class="forms-loading" style="display: none;"></span>
            </button>
        </form>
    </div>

    <script src="/static/js/forms.js"></script>
    <script>
        // Set default date to today
        document.getElementById('follow_up_date').valueAsDate = new Date();

        // Show/hide conditional fields
        document.querySelectorAll('input[name="active_interchanges_status"]').forEach(radio => {
            radio.addEventListener('change', function () {
                const workingGroup = document.getElementById('interchangesWorkingGroup');
                if (this.value !== 'none') {
                    workingGroup.style.display = 'block';
                } else {
                    workingGroup.style.display = 'none';
                }
            });
        });

        document.querySelectorAll('input[name="follow_up_priority"]').forEach(radio => {
            radio.addEventListener('change', function () {
                const nextGroup = document.getElementById('nextFollowupGroup');
                if (this.value !== 'closed') {
                    nextGroup.style.display = 'block';
                } else {
                    nextGroup.style.display = 'none';
                }
            });
        });

        // Form submission
        document.getElementById('followupForm').addEventListener('submit', async function (e) {
            e.preventDefault();

            const token = localStorage.getItem('access_token');
            if (!token) {
                showError('Debes iniciar sesiÃ³n para registrar seguimientos');
                return;
            }

            const formData = {
                follow_up_date: document.getElementById('follow_up_date').value,
                participant_id: 1, // TODO: Get from participant lookup
                related_interchange_id: null, // TODO: Get from interchange lookup
                follow_up_type: document.querySelector('input[name="follow_up_type"]:checked').value,
                current_situation: document.getElementById('current_situation').value,
                need_level: parseInt(document.querySelector('input[name="need_level"]:checked').value),
                situation_change: document.querySelector('input[name="situation_change"]:checked').value,
                active_interchanges_status: document.querySelector('input[name="active_interchanges_status"]:checked').value,
                interchanges_working_well: document.querySelector('input[name="interchanges_working_well"]:checked')?.value || null,
                new_needs_detected: getCheckedValues('new_needs_detected'),
                new_offers_detected: getCheckedValues('new_offers_detected'),
                emotional_state: document.querySelector('input[name="emotional_state"]:checked')?.value || null,
                community_connection: document.querySelector('input[name="community_connection"]:checked') ?
                    parseInt(document.querySelector('input[name="community_connection"]:checked').value) : null,
                actions_required: getCheckedValues('actions_required'),
                follow_up_priority: document.querySelector('input[name="follow_up_priority"]:checked').value,
                next_follow_up_date: document.getElementById('next_follow_up_date').value || null,
                facilitator_notes: document.getElementById('facilitator_notes').value || null,
                learnings: document.getElementById('learnings').value || null
            };

            await submitFollowupForm(formData, token);
        });

        function getCheckedValues(name) {
            return Array.from(document.querySelectorAll(`input[name="${name}"]:checked`))
                .map(cb => cb.value);
        }

        async function submitFollowupForm(data, token) {
            const submitBtn = document.getElementById('submitBtn');
            const submitText = document.getElementById('submitText');
            const submitLoading = document.getElementById('submitLoading');
            const errorMessage = document.getElementById('errorMessage');
            const errorText = document.getElementById('errorText');

            submitBtn.disabled = true;
            submitText.style.display = 'none';
            submitLoading.style.display = 'inline-block';
            errorMessage.style.display = 'none';

            try {
                const response = await fetch('/forms/follow-up', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();

                if (response.ok && result.success) {
                    const priorityEmoji = data.follow_up_priority === 'high' ? 'ğŸ”´' :
                        data.follow_up_priority === 'medium' ? 'ğŸŸ¡' :
                            data.follow_up_priority === 'low' ? 'ğŸŸ¢' : 'âœ…';
                    document.getElementById('successDetails').textContent =
                        `Seguimiento registrado con prioridad ${priorityEmoji} ${data.follow_up_priority}.`;
                    document.getElementById('followupForm').style.display = 'none';
                    document.getElementById('successMessage').style.display = 'block';
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                } else {
                    errorText.textContent = result.error || 'OcurriÃ³ un error al enviar el formulario';
                    errorMessage.style.display = 'flex';
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
            } catch (error) {
                errorText.textContent = 'Error de conexiÃ³n. Por favor intenta de nuevo.';
                errorMessage.style.display = 'flex';
                window.scrollTo({ top: 0, behavior: 'smooth' });
            } finally {
                submitBtn.disabled = false;
                submitText.style.display = 'inline';
                submitLoading.style.display = 'none';
            }
        }

        function showError(message) {
            const errorMessage = document.getElementById('errorMessage');
            const errorText = document.getElementById('errorText');
            errorText.textContent = message;
            errorMessage.style.display = 'flex';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function resetForm() {
            document.getElementById('followupForm').reset();
            document.getElementById('followupForm').style.display = 'block';
            document.getElementById('successMessage').style.display = 'none';
            document.getElementById('follow_up_date').valueAsDate = new Date();
            document.getElementById('interchangesWorkingGroup').style.display = 'none';
            document.getElementById('nextFollowupGroup').style.display = 'none';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    </script>
</body>

</html>